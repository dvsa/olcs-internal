<?php

/** @var array $revoke */

use Common\RefData;

$items = [
    [
        'label' => 'Submission required for approval of ptr',
        'value' => $revoke['isSubmissionRequiredForApproval'] === null
            ? null
            : ($revoke['isSubmissionRequiredForApproval'] ? 'Y' : 'N'),
    ],
];

if ($revoke['isSubmissionRequiredForApproval']) {
    $items = array_merge(
        $items,
        [
            [
                'label' => 'Date approval submission issued',
                'date' => $revoke['approvalSubmissionIssuedDate'],
                'suffix' => $this->slaIndicator()->hasTargetBeenMet(
                    $revoke['approvalSubmissionIssuedDate'],
                    isset($revoke['approvalSubmissionIssuedDateTarget'])
                        ? $revoke['approvalSubmissionIssuedDateTarget']
                        : null
                ),
            ],
            [
                'label' => 'Date approval submission returned',
                'date' => $revoke['approvalSubmissionReturnedDate'],
                'suffix' => $this->slaIndicator()->hasTargetBeenMet(
                    $revoke['approvalSubmissionReturnedDate'],
                    isset($revoke['approvalSubmissionReturnedDateTarget'])
                        ? $revoke['approvalSubmissionReturnedDateTarget']
                        : null
                ),
            ],
            [
                'label' => 'Approval submission TC/TDC',
                'value' => $revoke['approvalSubmissionPresidingTc']
                    ? $revoke['approvalSubmissionPresidingTc']['name']
                    : null,
                'suffix' => $this->slaIndicator()->hasTargetBeenMet(
                    $revoke['approvalSubmissionPresidingTc'],
                    isset($revoke['approvalSubmissionPresidingTcTarget'])
                        ? $revoke['approvalSubmissionPresidingTcTarget']
                        : null
                ),
            ],
        ]
    );
}

$items = array_merge(
    $items,
    [
        [
            'label' => 'Date IOR letter issued',
            'date' => $revoke['iorLetterIssuedDate'],
            'suffix' => $this->slaIndicator()->hasTargetBeenMet(
                $revoke['iorLetterIssuedDate'],
                isset($revoke['iorLetterIssuedDateTarget'])
                    ? $revoke['iorLetterIssuedDateTarget']
                    : null
            ),
        ],
        [
            'label' => 'Date Operator\'s response due',
            'date' => $revoke['operatorResponseDueDate'],
            'suffix' => $this->slaIndicator()->hasTargetBeenMet(
                $revoke['operatorResponseDueDate'],
                isset($revoke['operatorResponseDueDateTarget'])
                    ? $revoke['operatorResponseDueDateTarget']
                    : null
            ),
        ],
        [
            'label' => 'Date Response Received',
            'date' => $revoke['operatorResponseReceivedDate'],
            'suffix' => $this->slaIndicator()->hasTargetBeenMet(
                $revoke['operatorResponseReceivedDate'],
                isset($revoke['operatorResponseReceivedDateTarget'])
                    ? $revoke['operatorResponseReceivedDateTarget']
                    : null
            ),
        ],

        [
            'label' => 'Is submission required for action',
            'value' => $revoke['isSubmissionRequiredForAction'] === null
                ? null
                : ($revoke['isSubmissionRequiredForAction'] ? 'Y' : 'N'),
        ],
    ]
);

if ($revoke['isSubmissionRequiredForAction']) {
    $items = array_merge(
        $items,
        [
            [
                'label' => 'Date final submission issued',
                'value' => $revoke['finalSubmissionIssuedDate'],
                'suffix' => $this->slaIndicator()->hasTargetBeenMet(
                    $revoke['finalSubmissionIssuedDate'],
                    isset($revoke['finalSubmissionIssuedDateTarget'])
                        ? $revoke['finalSubmissionIssuedDateTarget']
                        : null
                ),
            ],
            [
                'label' => 'Date final submission returned',
                'value' => $revoke['finalSubmissionReturnedDate'],
                'suffix' => $this->slaIndicator()->hasTargetBeenMet(
                    $revoke['finalSubmissionReturnedDate'],
                    isset($revoke['finalSubmissionReturnedDateTarget'])
                        ? $revoke['finalSubmissionReturnedDateTarget']
                        : null
                ),
            ],
            [
                'label' => 'Final submission TC/DTC',
                'value' => $revoke['finalSubmissionPresidingTc']
                    ? $revoke['finalSubmissionPresidingTc']['name']
                    : null,
            ],
        ]
    );
}

$items[] = [
    'label' => 'Action to be taken',
    'value' => $revoke['actionToBeTaken']
        ? $revoke['actionToBeTaken']['description']
        : null,
];

if ($revoke['actionToBeTaken']) {
    switch ($revoke['actionToBeTaken']['id']) {
        case RefData::PTR_ACTION_TO_BE_TAKEN_REVOKE:
            $items[] = [
                'label' => 'Revocation letter issued date',
                'date' => $revoke['revocationLetterIssuedDate'],
                'suffix' => $this->slaIndicator()->hasTargetBeenMet(
                    $revoke['revocationLetterIssuedDate'],
                    isset($revoke['revocationLetterIssuedDateTarget'])
                        ? $revoke['revocationLetterIssuedDateTarget']
                        : null
                ),
            ];
            break;
        case RefData::PTR_ACTION_TO_BE_TAKEN_NFA:
            $items[] = [
                'label' => 'NFA letter issued date',
                'date' => $revoke['nfaLetterIssuedDate'],
                'suffix' => $this->slaIndicator()->hasTargetBeenMet(
                    $revoke['nfaLetterIssuedDate'],
                    isset($revoke['nfaLetterIssuedDateTarget'])
                        ? $revoke['nfaLetterIssuedDateTarget']
                        : null
                ),
            ];
            break;
        case RefData::PTR_ACTION_TO_BE_TAKEN_WARNING:
            $items[] = [
                'label' => 'Warning letter issued date',
                'date' => $revoke['warningLetterIssuedDate'],
                'suffix' => $this->slaIndicator()->hasTargetBeenMet(
                    $revoke['warningLetterIssuedDate'],
                    isset($revoke['warningLetterIssuedDateTarget'])
                        ? $revoke['warningLetterIssuedDateTarget']
                        : null
                ),
            ];
            break;
        case RefData::PTR_ACTION_TO_BE_TAKEN_PI:
            $items[] = [
                'label' => 'PI Agreed',
                'date' => $revoke['piAgreedDate'],
                'suffix' => $this->slaIndicator()->hasTargetBeenMet(
                    $revoke['piAgreedDate'],
                    isset($revoke['piAgreedDateTarget'])
                        ? $revoke['piAgreedDateTarget']
                        : null
                ),
            ];
            break;
        case RefData::PTR_ACTION_TO_BE_TAKEN_OTHER:
            $items[] = [
                'label' => 'Other Action agreed',
                'date' => $revoke['otherActionAgreedDate'],
                'suffix' => $this->slaIndicator()->hasTargetBeenMet(
                    $revoke['otherActionAgreedDate'],
                    isset($revoke['otherActionAgreedDateTarget'])
                        ? $revoke['otherActionAgreedDateTarget']
                        : null
                ),
            ];
            break;
    };
}

$actions = [
    [
        'label' => 'Edit',
        'url' => $this->url(
            'processing_in_office_revocation_sla',
            ['action' => 'edit'],
            [],
            true
        ),
        'class' => 'action--secondary js-modal-ajax'
    ],
];
echo $this->render(
    'partials/read-only/main',
    [
        'header' => 'Service level agreement',
        'actions' => $actions,
        'items' => $items
    ]
);

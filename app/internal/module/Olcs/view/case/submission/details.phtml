<?php

$case = $this->placeholder('case')->getValue();
$submission = $this->placeholder('submission')->getValue();
$selectedSectionsArray = $this->placeholder('selectedSectionsArray')->getValue();

$freetext = '';

$selectedIds = array_column($selectedSectionsArray, 'sectionId');
foreach ($allSections as $sectionId => $sectionDescription) {
    if (in_array($sectionId, $selectedIds))
    {
        $key = array_search($sectionId, $selectedIds);

        $freetext .= $this->submissionSectionDetails($selectedSectionsArray[$key]['sectionId'], $selectedSectionsArray[$key]);
        $freetext .= $this->partial('case/submission/partials/comments',
            [
                'section' => $selectedSectionsArray[$key],
                'caseId' => $case['id'],
                'submissionId' => $submission['id']
            ]
        );
    }
}

//last submission
echo $this->render('partials/read-only/main',
    [
        'header' => $submission['submissionTypeTitle'],
        'actions' => [
            [
                'label' => 'Return to list',
                'url' => $this->url(
                    'submission', [
                        'case' => $case['id'],
                        'action' => 'index'
                    ]
                )
            ],
            [
                'label' => 'Edit submission',
                'url' => $this->url(
                    'submission', [
                        'case' => $case['id'],
                        'action' => 'edit',
                        'submission' => $submission['id']
                    ]
                )
            ]
        ],
        'freetext' => $freetext
    ]
);

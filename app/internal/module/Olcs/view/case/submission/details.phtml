<?php

$case = $this->placeholder('case')->getValue();
$submission = $this->placeholder('submission')->getValue();
$selectedSectionsArray = $this->placeholder('selectedSectionsArray')->getValue();

$freetext = '';

$selectedIds = array_column($selectedSectionsArray, 'sectionId');

foreach ($allSections as $sectionId => $sectionDescription) {
    if (array_key_exists($sectionId, $selectedSectionsArray))
    {
        $freetext .= $this->submissionSectionDetails(
            $sectionId,
            $selectedSectionsArray[$sectionId]
        );
        if (isset($submissionConfig[$sectionId]['allow_comments']) && $submissionConfig[$sectionId]['allow_comments']) {
            $freetext .= $this->partial('case/submission/partials/comments',
                [
                    'sectionId' => $sectionId,
                    'section' => $selectedSectionsArray[$sectionId],
                    'caseId' => $case['id'],
                    'submissionId' => $submission['id']
                ]
            );
        }
    }
}

//last submission
echo $this->render('partials/read-only/main',
    [
        'header' => $submission['submissionTypeTitle'],
        'actions' => [
            [
                'label' => 'Return to list',
                'url' => $this->url(
                    'submission', [
                        'case' => $case['id'],
                        'action' => 'index'
                    ]
                )
            ],
            [
                'label' => 'Edit submission',
                'url' => $this->url(
                    'submission', [
                        'case' => $case['id'],
                        'action' => 'edit',
                        'submission' => $submission['id']
                    ]
                )
            ]
        ],
        'freetext' => $freetext
    ]
);
